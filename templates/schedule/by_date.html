<!-- templates/schedule/by_date.html -->

{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>{{ selected_date.strftime('%Yå¹´%mæœˆ%dæ—¥') }} ã®å·¥ç¨‹äºˆå®š</h3>
    <a href="{{ url_for('main.schedule_calendar') }}" class="btn btn-secondary">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</a>
  </div>

  {# â”€â”€â”€ æ—¥ä»˜å…¨ä½“ã®ãƒ¡ãƒ¢ãƒ•ã‚©ãƒ¼ãƒ ï¼è¡¨ç¤º â”€â”€â”€ #}
  {% if current_user.company_name == 'è±è¼é‡‘å‹å·¥æ¥­' %}
    <form method="POST" class="card mb-4">
      <div class="card-body">
        <h5>æ—¥ä»˜ãƒ¡ãƒ¢ã®ç·¨é›†</h5>
        <div class="mb-3">
          <label for="date_client_person">ä¾é ¼å…ƒæ‹…å½“è€…</label>
          <input
            id="date_client_person"
            type="text"
            name="date_client_person"
            class="form-control"
            value="{{ date_note.client_person if date_note else '' }}"
          >
        </div>
        <div class="mb-3">
          <label for="date_client_comment">æ—¥ä»˜ãƒ¡ãƒ¢ï¼ã‚³ãƒ¡ãƒ³ãƒˆ</label>
          <textarea
            id="date_client_comment"
            name="date_client_comment"
            class="form-control"
            rows="3"
          >{{ date_note.client_comment if date_note else '' }}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">ãƒ¡ãƒ¢ã‚’ä¿å­˜</button>
      </div>
    </form>
  {% else %}
    {% if date_note %}
      <div class="alert alert-info mb-4">
        <strong>æ—¥ä»˜ãƒ¡ãƒ¢ï¼š</strong> {{ date_note.client_comment }}<br>
        <small>ä¾é ¼å…ƒæ‹…å½“ï¼š{{ date_note.client_person }}</small>
      </div>
    {% endif %}
  {% endif %}


  {# â”€â”€â”€ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§ â”€â”€â”€ #}
  {% for s in schedules %}
    <div class="card mb-3">
      <div class="card-body">
        <h5>{{ s.task_name }}ï¼ˆ{{ s.time_slot }}ï¼‰ @ {{ s.site_name }}</h5>
        <p>ğŸ¢ ä¼šç¤¾ï¼š{{ s.company.company_name }}</p>
        <p>æ‹…å½“ï¼š{{ s.person_in_charge }}</p>
        <p>ğŸ”§ ä½œæ¥­è©³ç´°ï¼š{{ s.comment or 'ï¼ˆãªã—ï¼‰' }}</p>

        {% if current_user.company_name == 'è±è¼é‡‘å‹å·¥æ¥­' %}
          {# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ãƒ¡ãƒ¢ç·¨é›†ãƒªãƒ³ã‚¯ #}
          <a
            href="{{ url_for('main.edit_client_comment', id=s.id) }}"
            class="btn btn-sm btn-outline-primary mt-2"
          >ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¡ãƒ¢ç·¨é›†</a>
          <form
            method="POST"
            action="{{ url_for('main.delete_client_comment', id=s.id) }}"
            style="display:inline;"
            onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');"
          >
            <button class="btn btn-sm btn-outline-danger mt-2">
              ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¡ãƒ¢å‰Šé™¤
            </button>
          </form>
        {% else %}
          <p class="mt-3">ğŸ“ è±è¼é‡‘å‹å·¥æ¥­æ§˜ã‚³ãƒ¡ãƒ³ãƒˆï¼š{{ s.client_comment or 'ï¼ˆãªã—ï¼‰' }}</p>
          <p>ğŸ‘¤ è±è¼é‡‘å‹å·¥æ¥­ã”æ‹…å½“è€…ï¼š{{ s.client_person or 'ï¼ˆæœªè¨˜å…¥ï¼‰' }}</p>
        {% endif %}

      </div>
    </div>
  {% else %}
    <p>äºˆå®šã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
  {% endfor %}


  {# â”€â”€â”€ ä½œæ¥­ä¼šç¤¾å‘ã‘ï¼šä¸€æ‹¬ç·¨é›†ï¼†æ–°è¦è¿½åŠ  â”€â”€â”€ #}
  {% if current_user.company_name != 'è±è¼é‡‘å‹å·¥æ¥­' %}
    <h4 class="mt-5">ğŸ› ï¸ äºˆå®šã®ä¸€æ‹¬ç·¨é›†</h4>
    <form method="POST">
      {% for s in schedules if s.company_id == current_user.id %}
        <div class="card mb-3">
          <div class="card-body">
            <input type="hidden" name="schedule_id_{{ s.id }}" value="{{ s.id }}">
            <div class="mb-2">
              <strong>æ‹…å½“è€…:</strong>
              <input
                type="text"
                name="person_in_charge_{{ s.id }}"
                value="{{ s.person_in_charge }}"
                class="form-control"
              >
            </div>
            <div class="mb-2">
              <strong>æ™‚é–“å¸¯:</strong>
              <select name="time_slot_{{ s.id }}" class="form-control">
                {% for slot in ['åˆå‰','åˆå¾Œ','çµ‚æ—¥','å¤œ'] %}
                  <option value="{{ slot }}" {% if slot == s.time_slot %}selected{% endif %}>
                    {{ slot }}
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-2">
              <strong>ä½œæ¥­å†…å®¹:</strong>
              <input
                type="text"
                name="task_name_{{ s.id }}"
                value="{{ s.task_name }}"
                class="form-control"
              >
            </div>
            <div class="mb-2">
              <strong>ã‚³ãƒ¡ãƒ³ãƒˆ:</strong>
              <textarea
                name="comment_{{ s.id }}"
                class="form-control"
                rows="2"
              >{{ s.comment }}</textarea>
            </div>
          </div>
        </div>
      {% endfor %}

      <div class="text-center mb-4">
        <button type="submit" class="btn btn-primary">æ›´æ–°</button>
        <a href="{{ url_for('main.schedule_calendar') }}" class="btn btn-secondary">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</a>
      </div>
    </form>

    <h4 class="mt-5">ğŸ”° æ–°ã—ã„å·¥ç¨‹äºˆå®šã‚’è¿½åŠ </h4>
    <form method="POST" action="{{ url_for('main.schedule_add') }}">
      <div class="mb-3">
        <label>æ™‚é–“å¸¯</label>
        <select name="time_slot" class="form-control" required>
          <option value="">â€” é¸æŠ â€”</option>
          <option value="åˆå‰">åˆå‰</option>
          <option value="åˆå¾Œ">åˆå¾Œ</option>
          <option value="çµ‚æ—¥">çµ‚æ—¥</option>
          <option value="å¤œ">å¤œ</option>
        </select>
      </div>
      <div class="mb-3">
        <label>é–‹å§‹æ—¥</label>
        <input type="date" name="date" class="form-control" required>
      </div>
      <div class="mb-3">
        <label>çµ‚äº†æ—¥</label>
        <input type="date" name="end_date" class="form-control">
      </div>
      <div class="mb-3">
        <label>ä½œæ¥­å†…å®¹</label>
        <input type="text" name="task_name" class="form-control" required>
      </div>
      <div class="mb-3">
        <label>æ‹…å½“è€…</label>
        <input type="text" name="person_in_charge" class="form-control" required>
      </div>
      <div class="mb-3">
        <label>ç¾å ´å</label>
        <input type="text" name="site_name" class="form-control" required>
      </div>
      <div class="text-center">
        <button type="submit" class="btn btn-success">è¿½åŠ </button>
        <a href="{{ url_for('main.schedule_calendar') }}" class="btn btn-secondary ml-2">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</a>
      </div>
    </form>
  {% endif %}

</div>
{% endblock %}
